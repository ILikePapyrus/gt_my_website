<!DOCTYPE html>

<html lang="it">
    <head>
        <!-- Base per sito -->
        <meta charset="UTF-8">
        <title>Convertitore Valute</title>

        <!-- Import Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

        <!-- Import CSS -->
        <link rel="stylesheet" href="../css/CSS_conversioneValute.css">

        <!-- Favicon -->
        <link rel="icon" href="../dollar-banknote_1f4b5.png" type="image/png">
    </head>
    <body>
        <!-- Titolo -->
        <h1>Convertitore di Valute</h1>

        <!-- Convertitore -->
        <div class="d-flex justify-content-between convertitore">
            <div class="w-50"> <!-- w-50 == dimensione -->
                <div class="input-group mb-3">
                    <!-- Seleziona valuta di partenza -->
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="dropdownValutaPartenza">Valuta di Partenza</button>
                    <!-- Lista valute da selezionare -->
                    <ul class="dropdown-menu custom-scroll-dropdown-menu" aria-labelledby="dropdownValutaPartenza" id="menuPartenza">                        <li><a class="dropdown-item" href="#" data-value="USD">USD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="JPY">JPY</a></li>
                        <li><a class="dropdown-item" href="#" data-value="BGN">BGN</a></li>
                        <li><a class="dropdown-item" href="#" data-value="CZK">CZK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="DKK">DKK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="GBP">GBP</a></li>
                        <li><a class="dropdown-item" href="#" data-value="HUF">HUF</a></li>
                        <li><a class="dropdown-item" href="#" data-value="PLN">PLN</a></li>
                        <li><a class="dropdown-item" href="#" data-value="RON">RON</a></li>
                        <li><a class="dropdown-item" href="#" data-value="SEK">SEK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="CHF">CHF</a></li>
                        <li><a class="dropdown-item" href="#" data-value="ISK">ISK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="NOK">NOK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="TRY">TRY</a></li>
                        <li><a class="dropdown-item" href="#" data-value="AUD">AUD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="BRL">BRL</a></li>
                        <li><a class="dropdown-item" href="#" data-value="CAD">CAD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="CNY">CNY</a></li>
                        <li><a class="dropdown-item" href="#" data-value="HKD">HKD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="IDR">IDR</a></li>
                        <li><a class="dropdown-item" href="#" data-value="ILS">ILS</a></li>
                        <li><a class="dropdown-item" href="#" data-value="INR">INR</a></li>
                        <li><a class="dropdown-item" href="#" data-value="KRW">KRW</a></li>
                        <li><a class="dropdown-item" href="#" data-value="MXN">MXN</a></li>
                        <li><a class="dropdown-item" href="#" data-value="MYR">MYR</a></li>
                        <li><a class="dropdown-item" href="#" data-value="NZD">NZD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="PHP">PHP</a></li>
                        <li><a class="dropdown-item" href="#" data-value="SGD">SGD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="THB">THB</a></li>
                        <li><a class="dropdown-item" href="#" data-value="ZAR">ZAR</a></li>
                    </ul>
                    <!-- Input valore da convertire -->
                    <input type="number" step="0.01" min="0" class="form-control" aria-label="Text input with dropdown button" placeholder="0.01" id="valoreIn">
                    <!-- Simbolo valuta -->
                    <span class="input-group-text" id="simboloPartenza">/</span>

                    <!-- Pulsante per confermare conversione della valuta -->
                    <div class="input-group-prepend freccia">
                        <button type="button" class="btn btn-secondary" onclick="loadXMLDoc()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Valuta convertita -->

                    <!-- Lista valuta finale -->
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="dropdownValutaFinale">Valuta Finale</button>
                    <ul class="dropdown-menu custom-scroll-dropdown-menu" aria-labelledby="dropdownValutaFinale" id="menuFinale">                        <li><a class="dropdown-item" href="#" data-value="USD">USD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="JPY">JPY</a></li>
                        <li><a class="dropdown-item" href="#" data-value="BGN">BGN</a></li>
                        <li><a class="dropdown-item" href="#" data-value="CZK">CZK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="DKK">DKK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="GBP">GBP</a></li>
                        <li><a class="dropdown-item" href="#" data-value="HUF">HUF</a></li>
                        <li><a class="dropdown-item" href="#" data-value="PLN">PLN</a></li>
                        <li><a class="dropdown-item" href="#" data-value="RON">RON</a></li>
                        <li><a class="dropdown-item" href="#" data-value="SEK">SEK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="CHF">CHF</a></li>
                        <li><a class="dropdown-item" href="#" data-value="ISK">ISK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="NOK">NOK</a></li>
                        <li><a class="dropdown-item" href="#" data-value="TRY">TRY</a></li>
                        <li><a class="dropdown-item" href="#" data-value="AUD">AUD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="BRL">BRL</a></li>
                        <li><a class="dropdown-item" href="#" data-value="CAD">CAD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="CNY">CNY</a></li>
                        <li><a class="dropdown-item" href="#" data-value="HKD">HKD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="IDR">IDR</a></li>
                        <li><a class="dropdown-item" href="#" data-value="ILS">ILS</a></li>
                        <li><a class="dropdown-item" href="#" data-value="INR">INR</a></li>
                        <li><a class="dropdown-item" href="#" data-value="KRW">KRW</a></li>
                        <li><a class="dropdown-item" href="#" data-value="MXN">MXN</a></li>
                        <li><a class="dropdown-item" href="#" data-value="MYR">MYR</a></li>
                        <li><a class="dropdown-item" href="#" data-value="NZD">NZD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="PHP">PHP</a></li>
                        <li><a class="dropdown-item" href="#" data-value="SGD">SGD</a></li>
                        <li><a class="dropdown-item" href="#" data-value="THB">THB</a></li>
                        <li><a class="dropdown-item" href="#" data-value="ZAR">ZAR</a></li>
                    </ul>
                    <!-- Risultato -->
                    <input type="number" step="0.01" min="0" class="form-control" aria-label="Text input with dropdown button" placeholder="0.01" id="valoreOut" disabled>
                    <!-- Simbolo valuta -->
                    <span class="input-group-text">/</span>
                </div>
            </div>
        </div>

        <br>
        <br>
        <p>In realtà è inutile mettere una valuta di partenza, non cambia nulla...</p>

        <!-- JAVASCRIPT -->
        <script>
                // Lettore XML
                function loadXMLDoc() {
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if(this.readyState == 4 && this.status == 200) {
                            // Inserire nome funzione e passargli xml
                            convertitore(this);
                        }
                    }
                    xhttp.open("GET", "../XMl/eurofxref-daily.xml", true);
                    xhttp.send();
                }

                // Converte la quantità in input
                function convertitore(xml) {
                    // Importa XML
                    var xmlDocs = xml.responseXML;
                    // Legge tutto il file
                    var cubes = xmlDocs.getElementsByTagName("Cube");
                    // Dizionario dove salvare valute
                    var rates = {};

                    // Riempie dizionario
                    for(var i=0; i<cubes.length; i++) {
                        var currency = cubes[i].getAttribute("currency");
                        var rate = cubes[i].getAttribute("rate");
                        if(currency && rate) {
                            rates[currency] = parseFloat(rate);
                        }
                    }

                    // Stampa in console dizionario
                    console.log(rates)

                    // Valore in ingresso
                    var valoreIn = parseFloat(document.getElementById("valoreIn").value);
                    console.log(valoreIn);
                    // Valuta in cui si vuole convertire
                    var valutaFinale = document.getElementById("dropdownValutaFinale");
                    console.log(valutaFinale);

                    // Conversione
                    if(rates[valutaFinale]) {
                        var valoreOut = valoreIn * rates[valutaFinale];
                        var contenutoCampoFinale = document.getElementById("valoreOut");
                        contenutoCampoFinale.disabled = false;
                        contenutoCampoFinale.value = valoreOut.toFixed(2);
                        contenutoCampoFinale.disabled = true;
                        // Stampa in console valore convertito
                        console.log(valoreOut.toFixed(2));
                    }
                }

                // Sostituisce il testo visibile nel dropdown con ciò che è selezionato
                function cambiaLabelDropdown(buttonId, menuId) {
                    var menu = document.getElementById(menuId);
                    var items = menu.getElementsByClassName('dropdown-item');
                    for (var i = 0; i < items.length; i++) {
                        items[i].addEventListener('click', function() {
                            var button = document.getElementById(buttonId);
                            button.textContent = this.getAttribute('data-value');
                        });
                    }
                }

                // Carica prima di tutto la funziona cambiaCarattere
                document.addEventListener('DOMContentLoaded', function() {
                    cambiaLabelDropdown('dropdownValutaPartenza', 'menuPartenza');
                    cambiaLabelDropdown('dropdownValutaFinale', 'menuFinale');
                });

                    /*
                    const listaCaratteriSoldi = [
                        '$',   // USD
                        '¥',   // JPY
                        'Лв',  // BGN
                        'Kč',  // CZK
                        'kr',  // DKK
                        '£',   // GBP
                        'Ft',  // HUF
                        'zł',  // PLN
                        'L',   // RON
                        'kr',  // SEK
                        'Fr',  // CHF
                        'kr',  // ISK
                        'kr',  // NOK
                        '₺',   // TRY
                        'A$',  // AUD
                        'R$',  // BRL
                        'C$',  // CAD
                        '元',   // CNY
                        'HK$',  // HKD
                        'Rp',   // IDR
                        '₪',    // ILS
                        '₹',    // INR
                        '₩',   // KRW
                        '$',   // MXN
                        'ރ',   // MYR
                        'NZ$', // NZD
                        '₱',   // PHP
                        'S$',  // SGD
                        '฿',   // THB
                        'R'    // ZAR
                    ];
                    document.getelementsById("simboloPartenza").value = ""; */
        </script>
    </body>
</html>